<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì› ì¸ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/navigation.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }

        .page-header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-xl) 0;
            margin-bottom: var(--spacing-lg);
        }

        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .page-description {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .date-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .date-control .form-control {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
        }

        .alert-section {
            margin-bottom: var(--spacing-lg);
        }

        .alert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--spacing-md);
        }

        .alert-card {
            background: var(--bg-primary);
            border-left: 4px solid var(--color-warning);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
        }

        .alert-card.danger {
            border-left-color: var(--color-danger);
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .alert-list {
            list-style: none;
            max-height: 250px;
            overflow-y: auto;
        }

        .alert-item {
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .teacher-name {
            font-weight: 500;
        }

        .teacher-details {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .date-badge {
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
        }

        .group-section {
            margin-bottom: var(--spacing-md);
        }

        .group-header {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--text-primary);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: var(--spacing-sm);
        }

        .subgroup-header {
            font-weight: 500;
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            padding: var(--spacing-xs) 0 var(--spacing-xs) var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
        }

        .group-section .alert-list {
            list-style: none;
            max-height: none;
            margin-bottom: var(--spacing-sm);
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">êµì› ì¸ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</a>
            <button class="navbar-toggle" aria-label="ë©”ë‰´ í† ê¸€">
                <span class="navbar-toggle-icon"></span>
            </button>
            <ul class="navbar-menu">
                <li class="navbar-item">
                    <a href="index.html" class="navbar-link" data-page="dashboard">ëŒ€ì‹œë³´ë“œ</a>
                </li>
                <li class="navbar-item">
                    <a href="promotion.html" class="navbar-link" data-page="promotion">ìŠ¹ì§„</a>
                </li>
                <li class="navbar-item">
                    <a href="reappointment.html" class="navbar-link" data-page="reappointment">ì¬ì„ìš©</a>
                </li>
                <li class="navbar-item">
                    <a href="data-management.html" class="navbar-link" data-page="data">ë°ì´í„° ê´€ë¦¬</a>
                </li>
                <li class="navbar-item">
                    <a href="process.html" class="navbar-link" data-page="process">í”„ë¡œì„¸ìŠ¤ & ê·œì •</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
            <p class="page-description">êµì› ì¸ì‚¬ ê´€ë¦¬ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
        </div>
    </div>

    <div class="container">
        <!-- ê¸°ì¤€ ë‚ ì§œ -->
        <div class="card">
            <div class="date-control">
                <label for="baseDate" class="form-label mb-0"><strong>ê¸°ì¤€ ë‚ ì§œ:</strong></label>
                <input type="date" id="baseDate" class="form-control" style="width: 180px;" onchange="onBaseDateChange()">
                <button class="btn btn-secondary btn-sm" onclick="setToday()">ì˜¤ëŠ˜</button>
                <span class="text-muted" id="baseDateDisplay">-</span>
            </div>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalFaculty">-</div>
                <div class="stat-label">ì „ì²´ ì „ì„êµì›</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="renewalAlerts">-</div>
                <div class="stat-label">ì¬ê³„ì•½ ì•Œë¦¼ ëŒ€ìƒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="promotionAlerts">-</div>
                <div class="stat-label">ìŠ¹ì§„ ì‹¬ì‚¬ ëŒ€ìƒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="urgentCases">-</div>
                <div class="stat-label">ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”</div>
            </div>
        </div>

        <!-- ì¬ê³„ì•½ ì•Œë¦¼ -->
        <div class="alert-section">
            <h2 class="section-title">ì¬ê³„ì•½ ì•Œë¦¼</h2>
            <div class="alert-grid">
                <div class="alert-card danger">
                    <div class="alert-title">
                        <span>ğŸ”´</span>
                        <span>ê¸´ê¸‰: 2ê°œì›” ì´ë‚´ ì¬ê³„ì•½ ì¢…ë£Œ</span>
                        <span class="badge badge-danger" id="urgentRenewalCount">-</span>
                    </div>
                    <ul class="alert-list" id="urgentRenewalList">
                        <li class="text-center text-muted p-3">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
                    </ul>
                </div>
                <div class="alert-card">
                    <div class="alert-title">
                        <span>ğŸŸ¡</span>
                        <span>ì£¼ì˜: 4ê°œì›” ì´ë‚´ ì¬ê³„ì•½ ì¢…ë£Œ</span>
                        <span class="badge badge-warning" id="warningRenewalCount">-</span>
                    </div>
                    <ul class="alert-list" id="warningRenewalList">
                        <li class="text-center text-muted p-3">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ìŠ¹ì§„ ì‹¬ì‚¬ ì•Œë¦¼ -->
        <div class="alert-section">
            <h2 class="section-title">ìŠ¹ì§„ ì‹¬ì‚¬ ì•Œë¦¼ (ë‹¹í•´ ì—°ë„)</h2>
            <div class="alert-grid">
                <div class="alert-card">
                    <div class="alert-title">
                        <span>ğŸ“‹</span>
                        <span>4ì›” ìŠ¹ì§„ ëŒ€ìƒ (2ì›” ë§ ë§ˆê°)</span>
                        <span class="badge badge-primary" id="aprilPromotionCount">-</span>
                    </div>
                    <div id="aprilPromotionContent">
                        <p class="text-center text-muted p-3">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
                <div class="alert-card">
                    <div class="alert-title">
                        <span>ğŸ“‹</span>
                        <span>10ì›” ìŠ¹ì§„ ëŒ€ìƒ (8ì›” ë§ ë§ˆê°)</span>
                        <span class="badge badge-primary" id="octoberPromotionCount">-</span>
                    </div>
                    <div id="octoberPromotionContent">
                        <p class="text-center text-muted p-3">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- êµì› í˜„í™© í…Œì´ë¸” -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">êµì› í˜„í™©</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="form-control" id="searchBox" placeholder="êµì›ëª…, ì†Œì†, ì§ê¸‰ ê²€ìƒ‰..." onkeyup="filterTable()">
                </div>
                <div class="table-wrapper" style="overflow-x: auto;">
                    <table class="table" id="facultyTable">
                        <thead>
                            <tr>
                                <th>ì„±ëª…</th>
                                <th>ì†Œì†</th>
                                <th>ì§ê¸‰</th>
                                <th>ì„ìš©ì¼</th>
                                <th>ì¬ì„ìš©ì‹œì‘ì¼</th>
                                <th>ì¢…ë£Œì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ë‹¤ìŒ ì‹¬ì‚¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="8" class="text-center p-4 text-muted">
                                    ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/common.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/promotion-engine.js"></script>
    <script>
        let facultyData = [];
        let filteredData = [];
        let currentBaseDate = new Date();
        let promotionEngine = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setToday();
        });

        // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •
        function setToday() {
            currentBaseDate = new Date();
            const dateInput = document.getElementById('baseDate');
            dateInput.value = DateUtils.formatDateForInput(currentBaseDate);
            updateBaseDateDisplay();
            if (facultyData.length > 0) {
                updateDashboard();
            }
        }

        // ê¸°ì¤€ ë‚ ì§œ ë³€ê²½ í•¸ë“¤ëŸ¬
        function onBaseDateChange() {
            const dateInput = document.getElementById('baseDate');
            if (dateInput.value) {
                const parts = dateInput.value.split('-');
                currentBaseDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                updateBaseDateDisplay();
                if (facultyData.length > 0) {
                    updateDashboard();
                }
            }
        }

        // ê¸°ì¤€ ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateBaseDateDisplay() {
            const displayElement = document.getElementById('baseDateDisplay');
            displayElement.textContent = DateUtils.formatDate(currentBaseDate) + ' ê¸°ì¤€';
        }

        // í—¤ë”ëª… ì •ê·œí™”
        function getTeacherValue(teacher, fieldName) {
            const possibleKeys = [
                fieldName,
                fieldName.replace(/\r?\n/g, ''),
                fieldName.replace(/\r?\n/g, '\r\n'),
                fieldName.replace(/\r?\n/g, '\n')
            ];

            for (const key of possibleKeys) {
                if (teacher[key] !== undefined && teacher[key] !== null) {
                    return teacher[key];
                }
            }
            return null;
        }

        // ì¢…ë£Œì¼ ê°€ì ¸ì˜¤ê¸°
        function getEndDate(teacher) {
            const renewalEndDate = DateUtils.parseDate(teacher['ì¬ì„ìš©ì¢…ë£Œì¼']);
            const initialEndDate = DateUtils.parseDate(getTeacherValue(teacher, 'ìµœì´ˆì„ìš©\nì¢…ë£Œì¼'));
            return renewalEndDate || initialEndDate;
        }

        // ì¬ê³„ì•½ ìƒíƒœ íŒì •
        function getRenewalStatus(endDate) {
            if (!endDate) return 'normal';
            const monthsUntil = DateUtils.getMonthsUntil(endDate, currentBaseDate);

            if (monthsUntil <= 2) return 'danger';
            if (monthsUntil <= 4) return 'warning';
            return 'normal';
        }

        // ì—‘ì…€ íŒŒì¼ ë¡œë“œ
        async function loadExcelFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const rawData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                    // í—¤ë” ì°¾ê¸°
                    let headerRowIndex = -1;
                    let headers = [];

                    for (let i = 0; i < rawData.length; i++) {
                        if (rawData[i] && rawData[i][0] === 'No.' && rawData[i].includes('ì„±ëª…')) {
                            headerRowIndex = i;
                            headers = rawData[i];
                            break;
                        }
                    }

                    if (headerRowIndex === -1) {
                        throw new Error('í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    // ë°ì´í„° ì¶”ì¶œ
                    const actualDataRows = rawData.slice(headerRowIndex + 1).filter(row =>
                        row && row.length > 0 && row[0] && typeof row[0] === 'number'
                    );

                    // ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜
                    const jsonData = actualDataRows.map(row => {
                        const obj = {};
                        headers.forEach((header, index) => {
                            obj[header] = row[index];
                        });
                        return obj;
                    });

                    // ì¬ì§ì¤‘ì¸ ì „ì„êµì›ë§Œ í•„í„°ë§
                    facultyData = jsonData.filter(teacher => {
                        const workStatus = teacher['ì¬ì§êµ¬ë¶„'];
                        const position = teacher['ì§ë ¬'];
                        return workStatus && workStatus.toString().includes('ì¬ì§') &&
                               position && position.toString().includes('ì „ì„êµì›');
                    });

                    if (facultyData.length === 0) {
                        alert('ì¬ì§ì¤‘ì¸ ì „ì„êµì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    filteredData = [...facultyData];

                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                    StorageUtils.set('facultyData', facultyData);

                    updateDashboard();

                } catch (error) {
                    console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            promotionEngine = new PromotionEngine(currentBaseDate);
            updateStats();
            updateRenewalAlerts();
            updatePromotionAlerts();
            updateFacultyTable();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const totalCount = facultyData.length;
            let renewalAlerts = 0;
            let urgentCases = 0;

            facultyData.forEach(teacher => {
                const endDate = getEndDate(teacher);
                const retirementDate = DateUtils.parseDate(teacher['ì •ë…„ì¼ì']);
                const isRetirement = DateUtils.isSameDate(endDate, retirementDate);

                if (!isRetirement) {
                    const status = getRenewalStatus(endDate);
                    if (status === 'warning') renewalAlerts++;
                    if (status === 'danger') {
                        renewalAlerts++;
                        urgentCases++;
                    }
                }
            });

            // ìŠ¹ì§„ ëŒ€ìƒì ê³„ì‚°
            const promotionCandidates = promotionEngine.calculateAllPromotions(facultyData);

            document.getElementById('totalFaculty').textContent = totalCount;
            document.getElementById('renewalAlerts').textContent = renewalAlerts;
            document.getElementById('promotionAlerts').textContent = promotionCandidates.length;
            document.getElementById('urgentCases').textContent = urgentCases;
        }

        // ì¬ê³„ì•½ ì•Œë¦¼ ì—…ë°ì´íŠ¸
        function updateRenewalAlerts() {
            const urgentList = document.getElementById('urgentRenewalList');
            const warningList = document.getElementById('warningRenewalList');

            urgentList.innerHTML = '';
            warningList.innerHTML = '';

            const urgentCases = [];
            const warningCases = [];

            facultyData.forEach(teacher => {
                const endDate = getEndDate(teacher);
                const retirementDate = DateUtils.parseDate(teacher['ì •ë…„ì¼ì']);

                if (DateUtils.isSameDate(endDate, retirementDate)) return;

                const status = getRenewalStatus(endDate);

                if (status === 'danger') {
                    urgentCases.push(teacher);
                } else if (status === 'warning') {
                    warningCases.push(teacher);
                }
            });

            if (urgentCases.length === 0) {
                urgentList.innerHTML = '<li class="text-center text-muted p-3">í•´ë‹¹ ì‚¬í•­ ì—†ìŒ</li>';
            } else {
                urgentCases.forEach(teacher => {
                    const endDate = getEndDate(teacher);
                    const daysLeft = DateUtils.getDaysUntil(endDate, currentBaseDate);

                    const li = document.createElement('li');
                    li.className = 'alert-item';
                    li.innerHTML = `
                        <div>
                            <div class="teacher-name">${teacher['ì„±ëª…']}</div>
                            <div class="teacher-details">${teacher['ì†Œì†']} â€¢ ${teacher['ì§ê¸‰']}</div>
                        </div>
                        <div class="date-badge">${daysLeft}ì¼ ë‚¨ìŒ</div>
                    `;
                    urgentList.appendChild(li);
                });
            }

            if (warningCases.length === 0) {
                warningList.innerHTML = '<li class="text-center text-muted p-3">í•´ë‹¹ ì‚¬í•­ ì—†ìŒ</li>';
            } else {
                warningCases.forEach(teacher => {
                    const endDate = getEndDate(teacher);
                    const monthsLeft = DateUtils.getMonthsUntil(endDate, currentBaseDate);

                    const li = document.createElement('li');
                    li.className = 'alert-item';
                    li.innerHTML = `
                        <div>
                            <div class="teacher-name">${teacher['ì„±ëª…']}</div>
                            <div class="teacher-details">${teacher['ì†Œì†']} â€¢ ${teacher['ì§ê¸‰']}</div>
                        </div>
                        <div class="date-badge">${monthsLeft}ê°œì›” ë‚¨ìŒ</div>
                    `;
                    warningList.appendChild(li);
                });
            }

            document.getElementById('urgentRenewalCount').textContent = urgentCases.length + 'ëª…';
            document.getElementById('warningRenewalCount').textContent = warningCases.length + 'ëª…';
        }

        // ìŠ¹ì§„ ì•Œë¦¼ ì—…ë°ì´íŠ¸
        function updatePromotionAlerts() {
            const aprilContent = document.getElementById('aprilPromotionContent');
            const octoberContent = document.getElementById('octoberPromotionContent');

            aprilContent.innerHTML = '';
            octoberContent.innerHTML = '';

            const promotionCandidates = promotionEngine.calculateAllPromotions(facultyData);
            const stats = promotionEngine.calculateStatistics(promotionCandidates);

            // ê·¸ë£¹ë³„ ë Œë”ë§ í•¨ìˆ˜
            function renderGroupedList(container, trackGroups) {
                let html = '';

                // ì •ë…„íŠ¸ë™
                if (trackGroups.tenure.associateToFull.length > 0 || trackGroups.tenure.assistantToAssociate.length > 0) {
                    html += '<div class="group-section">';
                    html += '<div class="group-header">ì •ë…„íŠ¸ë™ ì „ì„êµì›</div>';

                    // ë¶€êµìˆ˜ -> êµìˆ˜
                    if (trackGroups.tenure.associateToFull.length > 0) {
                        html += '<div class="subgroup-header">â–¸ ë¶€êµìˆ˜ â†’ êµìˆ˜ (' + trackGroups.tenure.associateToFull.length + 'ëª…)</div>';
                        html += '<ul class="alert-list">';
                        trackGroups.tenure.associateToFull.forEach(candidate => {
                            const teacher = candidate.teacher;
                            const info = candidate.promotionInfo;
                            html += `
                                <li class="alert-item">
                                    <div>
                                        <div class="teacher-name">${teacher['ì„±ëª…']}</div>
                                        <div class="teacher-details">${teacher['ì†Œì†']} â€¢ ${teacher['ì§ê¸‰']}</div>
                                    </div>
                                    <div class="date-badge">${DateUtils.formatDate(info.nextPromotionDate)}</div>
                                </li>
                            `;
                        });
                        html += '</ul>';
                    }

                    // ì¡°êµìˆ˜ -> ë¶€êµìˆ˜
                    if (trackGroups.tenure.assistantToAssociate.length > 0) {
                        html += '<div class="subgroup-header">â–¸ ì¡°êµìˆ˜ â†’ ë¶€êµìˆ˜ (' + trackGroups.tenure.assistantToAssociate.length + 'ëª…)</div>';
                        html += '<ul class="alert-list">';
                        trackGroups.tenure.assistantToAssociate.forEach(candidate => {
                            const teacher = candidate.teacher;
                            const info = candidate.promotionInfo;
                            html += `
                                <li class="alert-item">
                                    <div>
                                        <div class="teacher-name">${teacher['ì„±ëª…']}</div>
                                        <div class="teacher-details">${teacher['ì†Œì†']} â€¢ ${teacher['ì§ê¸‰']}</div>
                                    </div>
                                    <div class="date-badge">${DateUtils.formatDate(info.nextPromotionDate)}</div>
                                </li>
                            `;
                        });
                        html += '</ul>';
                    }

                    html += '</div>';
                }

                // ë¹„ì •ë…„íŠ¸ë™
                if (trackGroups.nonTenure.assistantToAssociate.length > 0) {
                    html += '<div class="group-section">';
                    html += '<div class="group-header">ë¹„ì •ë…„íŠ¸ë™ ì „ì„êµì›</div>';
                    html += '<div class="subgroup-header">â–¸ ì¡°êµìˆ˜ â†’ ë¶€êµìˆ˜ (' + trackGroups.nonTenure.assistantToAssociate.length + 'ëª…)</div>';
                    html += '<ul class="alert-list">';
                    trackGroups.nonTenure.assistantToAssociate.forEach(candidate => {
                        const teacher = candidate.teacher;
                        const info = candidate.promotionInfo;
                        html += `
                            <li class="alert-item">
                                <div>
                                    <div class="teacher-name">${teacher['ì„±ëª…']}</div>
                                    <div class="teacher-details">${teacher['ì†Œì†']} â€¢ ${teacher['ì§ê¸‰']}</div>
                                </div>
                                <div class="date-badge">${DateUtils.formatDate(info.nextPromotionDate)}</div>
                            </li>
                        `;
                    });
                    html += '</ul>';
                    html += '</div>';
                }

                if (html === '') {
                    html = '<p class="text-center text-muted p-3">í•´ë‹¹ ì‚¬í•­ ì—†ìŒ</p>';
                }

                container.innerHTML = html;
            }

            // 4ì›” ìŠ¹ì§„
            renderGroupedList(aprilContent, stats.groupsByTrack.april);

            // 10ì›” ìŠ¹ì§„
            renderGroupedList(octoberContent, stats.groupsByTrack.october);

            document.getElementById('aprilPromotionCount').textContent = stats.groups.april.length + 'ëª…';
            document.getElementById('octoberPromotionCount').textContent = stats.groups.october.length + 'ëª…';
        }

        // êµì› í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateFacultyTable() {
            const tbody = document.querySelector('#facultyTable tbody');
            tbody.innerHTML = '';

            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center p-4 text-muted">
                            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
                return;
            }

            filteredData.forEach(teacher => {
                const endDate = getEndDate(teacher);
                const status = getRenewalStatus(endDate);
                const firstAppointment = DateUtils.parseDate(getTeacherValue(teacher, 'ì „ì„êµì›\nìµœì´ˆì„ìš©ì¼'));
                const renewalStart = DateUtils.parseDate(teacher['ì¬ì„ìš©ì‹œì‘ì¼']);
                const promotionInfo = promotionEngine.getPromotionInfo(teacher);

                // ë‹¤ìŒ ì‹¬ì‚¬ ì •ë³´
                let nextReview = '-';
                if (promotionInfo.nextPromotionDate) {
                    nextReview = `ìŠ¹ì§„ ${DateUtils.formatDate(promotionInfo.nextPromotionDate)}`;
                } else if (endDate) {
                    nextReview = `ì¬ê³„ì•½ ${DateUtils.formatDate(endDate)}`;
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${teacher['ì„±ëª…'] || '-'}</td>
                    <td>${teacher['ì†Œì†'] || '-'}</td>
                    <td>${teacher['ì§ê¸‰'] || '-'}</td>
                    <td>${DateUtils.formatDate(firstAppointment)}</td>
                    <td>${DateUtils.formatDate(renewalStart)}</td>
                    <td>${DateUtils.formatDate(endDate)}</td>
                    <td><span class="badge badge-${status === 'danger' ? 'danger' : status === 'warning' ? 'warning' : 'success'}">
                        ${status === 'danger' ? 'ê¸´ê¸‰' : status === 'warning' ? 'ì£¼ì˜' : 'ì •ìƒ'}
                    </span></td>
                    <td>${nextReview}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ê²€ìƒ‰ í•„í„°
        function filterTable() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();

            filteredData = facultyData.filter(teacher => {
                const name = (teacher['ì„±ëª…'] || '').toLowerCase();
                const department = (teacher['ì†Œì†'] || '').toLowerCase();
                const rank = (teacher['ì§ê¸‰'] || '').toLowerCase();

                return name.includes(searchTerm) ||
                       department.includes(searchTerm) ||
                       rank.includes(searchTerm);
            });

            updateFacultyTable();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë³µì›
        window.addEventListener('load', () => {
            const savedData = StorageUtils.get('facultyData');
            if (savedData) {
                facultyData = savedData;
                filteredData = [...facultyData];
                updateDashboard();
            }
        });
    </script>
</body>
</html>
